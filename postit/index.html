<!--<link rel="stylesheet" href="main.css">-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadro de Post-its Interativo</title>
    <!-- Tailwind CSS para estilização rápida e moderna -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Biblioteca SortableJS para Drag and Drop (arrastar e soltar) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="main.css">
    <!-- Importação da fonte Inter do Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="h-screen flex flex-col">

    <!-- Cabeçalho -->
    <header class="bg-white shadow-md p-4 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <div class="bg-green-400 text-white p-3 rounded-lg shadow">
                <h1 class="font-bold text-lg">Seja bem vindo!</h1>
            </div>
            <button id="addColumnBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105">
                + Adicionar Coluna
            </button>
        </div>
        <div class="bg-blue-800 text-white p-3 rounded-lg shadow">
            <span class="font-semibold">Pedro Giusti</span>
        </div>
    </header>

    <!-- Container principal das colunas -->
    <main id="board" class="flex-1 flex gap-6 p-6 overflow-x-auto">
        <!-- Colunas serão adicionadas aqui via JavaScript -->
    </main>

    <!-- Template para uma nova coluna (invisível inicialmente) -->
    <template id="column-template">
        <div class="column bg-gray-200 rounded-xl shadow-lg flex flex-col w-80 md:w-96 flex-shrink-0">
            <div class="p-4 bg-white rounded-t-xl shadow-sm flex justify-between items-center">
                <h2 class="column-title text-xl font-bold text-gray-700" contenteditable="true">Nova Coluna</h2>
                <button class="remove-column-btn text-red-500 hover:text-red-700 font-bold text-xl">&times;</button>
            </div>
            <div class="p-4 flex-1">
                <div class="post-it-stack relative">
                    <!-- Post-its serão adicionados aqui -->
                </div>
            </div>
            <div class="p-4 border-t border-gray-300">
                <button class="add-post-it-btn bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg w-full transition-transform transform hover:scale-105">
                    + Adicionar Post-it
                </button>
            </div>
        </div>
    </template>

    <!-- Template para um novo post-it (invisível inicialmente) -->
    <template id="post-it-template">
        <div class="post-it absolute w-full h-64 rounded-lg shadow-md cursor-pointer border-2">
            <div class="post-it-header font-bold p-2 rounded-t-lg truncate">
                <span class="post-it-title">Novo Título</span>
            </div>
            <div class="post-it-content p-3 text-sm overflow-y-auto h-full">
                <p>Clique para editar...</p>
            </div>
            <button class="remove-post-it-btn absolute top-1 right-1 bg-black bg-opacity-20 hover:bg-opacity-40 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center">&times;</button>
        </div>
    </template>

    <!-- Modal para editar o conteúdo do post-it -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-11/12 md:w-1/2 lg:w-1/3">
            <h3 class="text-2xl font-bold mb-4">Editar Post-it</h3>
            <div class="mb-4">
                <label for="modal-title" class="block text-gray-700 font-bold mb-2">Título:</label>
                <input type="text" id="modal-title" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div class="mb-6">
                <label for="modal-content" class="block text-gray-700 font-bold mb-2">Conteúdo:</label>
                <textarea id="modal-content" rows="6" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
            </div>
            <div class="flex items-center justify-end gap-4">
                <button id="modal-cancel" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Cancelar
                </button>
                <button id="modal-save" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Salvar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Confirmação -->
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-11/12 md:w-1/3">
            <h3 id="confirm-modal-title" class="text-xl font-bold mb-4">Confirmar Ação</h3>
            <p id="confirm-modal-message" class="mb-6 text-gray-700">Você tem certeza?</p>
            <div class="flex items-center justify-end gap-4">
                <button id="confirm-modal-cancel" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Cancelar
                </button>
                <button id="confirm-modal-confirm" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Confirmar
                </button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos principais da UI
            const board = document.getElementById('board');
            const addColumnBtn = document.getElementById('addColumnBtn');
            const columnTemplate = document.getElementById('column-template');
            const postItTemplate = document.getElementById('post-it-template');
            
            // Elementos do Modal de Edição
            const editModal = document.getElementById('edit-modal');
            const modalTitleInput = document.getElementById('modal-title');
            const modalContentInput = document.getElementById('modal-content');
            const modalSaveBtn = document.getElementById('modal-save');
            const modalCancelBtn = document.getElementById('modal-cancel');
            
            // Elementos do Modal de Confirmação
            const confirmModal = document.getElementById('confirm-modal');
            const confirmModalMessage = document.getElementById('confirm-modal-message');
            const confirmModalConfirmBtn = document.getElementById('confirm-modal-confirm');
            const confirmModalCancelBtn = document.getElementById('confirm-modal-cancel');

            // Paleta de cores para os post-its
            const postItColors = [
                { id: 'yellow', bg: 'bg-yellow-200', border: 'border-yellow-400', header: 'bg-yellow-300' },
                { id: 'blue', bg: 'bg-blue-200', border: 'border-blue-400', header: 'bg-blue-300' },
                { id: 'green', bg: 'bg-green-200', border: 'border-green-400', header: 'bg-green-300' },
                { id: 'pink', bg: 'bg-pink-200', border: 'border-pink-400', header: 'bg-pink-300' },
                { id: 'purple', bg: 'bg-purple-200', border: 'border-purple-400', header: 'bg-purple-300' },
                { id: 'indigo', bg: 'bg-indigo-200', border: 'border-indigo-400', header: 'bg-indigo-300' },
            ];

            let currentEditingPostIt = null;

            // --- FUNÇÕES DE ESTADO (SALVAR E CARREGAR) ---

            /**
             * Salva o estado atual do quadro no localStorage.
             */
            function saveState() {
                const columns = [];
                document.querySelectorAll('.column').forEach(columnEl => {
                    const columnData = {
                        id: columnEl.dataset.id,
                        title: columnEl.querySelector('.column-title').textContent,
                        postIts: []
                    };
                    columnEl.querySelectorAll('.post-it').forEach(postItEl => {
                        const postItData = {
                            id: postItEl.dataset.id,
                            title: postItEl.querySelector('.post-it-title').textContent,
                            content: postItEl.querySelector('.post-it-content p').textContent,
                            colorId: postItEl.dataset.colorId
                        };
                        columnData.postIts.push(postItData);
                    });
                    columns.push(columnData);
                });
                localStorage.setItem('postItBoardState', JSON.stringify(columns));
            }

            /**
             * Carrega o estado do quadro do localStorage. Se não houver estado salvo, carrega um quadro padrão.
             */
            function loadState() {
                const savedState = localStorage.getItem('postItBoardState');
                if (savedState) {
                    const columns = JSON.parse(savedState);
                    columns.forEach(columnData => {
                        const newColumn = createColumn(columnData.title, columnData.id);
                        const stack = newColumn.querySelector('.post-it-stack');
                        columnData.postIts.forEach(postItData => {
                            createPostIt(stack, postItData);
                        });
                        rearrangeStack(stack);
                    });
                } else {
                    initializeDefaultBoard(); // Carrega o quadro de exemplo se não houver nada salvo
                }
            }

            // --- FUNÇÕES DE CRIAÇÃO DE ELEMENTOS ---

            /**
             * Cria uma nova coluna.
             * @param {string} title - O título da coluna.
             * @param {string} id - O ID único da coluna.
             * @returns {HTMLElement} O elemento da coluna criado.
             */
            function createColumn(title = 'Nova Coluna', id = `col-${Date.now()}`) {
                const columnClone = columnTemplate.content.cloneNode(true);
                const columnElement = columnClone.querySelector('.column');
                const columnTitleEl = columnElement.querySelector('.column-title');
                const addPostItBtn = columnElement.querySelector('.add-post-it-btn');
                const removeColumnBtn = columnElement.querySelector('.remove-column-btn');
                const postItStack = columnElement.querySelector('.post-it-stack');

                columnElement.dataset.id = id;
                columnTitleEl.textContent = title;
                board.appendChild(columnElement);

                columnTitleEl.addEventListener('blur', saveState);

                addPostItBtn.addEventListener('click', () => {
                    const newPostIt = createPostIt(postItStack);
                    openEditModal(newPostIt);
                });

                removeColumnBtn.addEventListener('click', () => {
                     showConfirmModal('Tem certeza que deseja remover esta coluna e todos os seus post-its?', () => {
                        board.removeChild(columnElement);
                        saveState();
                    });
                });

                new Sortable(postItStack, {
                    group: 'shared',
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    onEnd: () => {
                        rearrangeStack(postItStack);
                        // Também é preciso reorganizar a pilha de origem se o item veio de outra coluna
                        document.querySelectorAll('.post-it-stack').forEach(s => rearrangeStack(s));
                        saveState();
                    }
                });
                
                return columnElement;
            }

            /**
             * Cria um novo post-it.
             * @param {HTMLElement} stack - O container onde o post-it será adicionado.
             * @param {object} data - Os dados para popular o post-it (opcional).
             * @returns {HTMLElement} O elemento do post-it criado.
             */
            function createPostIt(stack, data = {}) {
                const postItClone = postItTemplate.content.cloneNode(true);
                const postItElement = postItClone.querySelector('.post-it');
                
                const id = data.id || `postit-${Date.now()}`;
                const title = data.title || 'Novo Título';
                const content = data.content || 'Clique para editar...';
                let color;
                if (data.colorId) {
                    color = postItColors.find(c => c.id === data.colorId) || postItColors[0];
                } else {
                    color = postItColors[Math.floor(Math.random() * postItColors.length)];
                }

                postItElement.dataset.id = id;
                postItElement.dataset.colorId = color.id;
                postItElement.querySelector('.post-it-title').textContent = title;
                postItElement.querySelector('.post-it-content p').textContent = content;

                postItElement.classList.add(color.bg, color.border);
                postItElement.querySelector('.post-it-header').classList.add(color.header);
                
                stack.appendChild(postItElement);
                addPostItEventListeners(postItElement);
                
                return postItElement;
            }

            // --- FUNÇÕES DE UI E EVENTOS ---

            function rearrangeStack(stack) {
                const postIts = Array.from(stack.querySelectorAll('.post-it'));
                const total = postIts.length;
                const titleHeight = 40;

                postIts.forEach((postIt, index) => {
                    postIt.style.zIndex = index;
                    postIt.style.top = `${(total - 1 - index) * titleHeight}px`;
                });
            }

            function addPostItEventListeners(postItElement) {
                postItElement.addEventListener('click', () => {
                    const stack = postItElement.parentElement;
                    stack.appendChild(postItElement);
                    rearrangeStack(stack);
                    saveState();
                });

                postItElement.querySelector('.post-it-content').addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    openEditModal(postItElement);
                });
                
                postItElement.querySelector('.post-it-header').addEventListener('dblclick', (e) => {
                    e.stopPropagation(); 
                    openEditModal(postItElement);
                });

                postItElement.querySelector('.remove-post-it-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    showConfirmModal('Tem certeza que deseja remover este post-it?', () => {
                        const stack = postItElement.parentElement;
                        stack.removeChild(postItElement);
                        rearrangeStack(stack);
                        saveState();
                    });
                });
            }

            function openEditModal(postItElement) {
                currentEditingPostIt = postItElement;
                const title = postItElement.querySelector('.post-it-title').textContent;
                const content = postItElement.querySelector('.post-it-content p').textContent;

                modalTitleInput.value = title === 'Novo Título' ? '' : title;
                modalContentInput.value = content === 'Clique para editar...' ? '' : content;
                editModal.classList.remove('hidden');
                editModal.classList.add('flex');
            }

            function closeEditModal() {
                currentEditingPostIt = null;
                editModal.classList.add('hidden');
                editModal.classList.remove('flex');
            }

            function saveModalChanges() {
                if (currentEditingPostIt) {
                    const newTitle = modalTitleInput.value.trim() || 'Sem Título';
                    const newContent = modalContentInput.value.trim();

                    currentEditingPostIt.querySelector('.post-it-title').textContent = newTitle;
                    currentEditingPostIt.querySelector('.post-it-content p').textContent = newContent;
                    saveState();
                }
                closeEditModal();
            }
            
            function showConfirmModal(message, onConfirmCallback) {
                confirmModalMessage.textContent = message;
                confirmModal.classList.remove('hidden');
                confirmModal.classList.add('flex');

                const confirmHandler = () => {
                    onConfirmCallback();
                    hideConfirmModal();
                    cleanup();
                };

                const cancelHandler = () => {
                    hideConfirmModal();
                    cleanup();
                };
                
                const cleanup = () => {
                    confirmModalConfirmBtn.removeEventListener('click', confirmHandler);
                    confirmModalCancelBtn.removeEventListener('click', cancelHandler);
                };

                confirmModalConfirmBtn.addEventListener('click', confirmHandler);
                confirmModalCancelBtn.addEventListener('click', cancelHandler);
            }

            function hideConfirmModal() {
                confirmModal.classList.add('hidden');
                confirmModal.classList.remove('flex');
            }


            // --- INICIALIZAÇÃO ---

            addColumnBtn.addEventListener('click', () => {
                createColumn();
                saveState();
            });
            
            modalSaveBtn.addEventListener('click', saveModalChanges);
            modalCancelBtn.addEventListener('click', closeEditModal);
            
            function initializeDefaultBoard() {
                const initialColumns = ['Urgente', 'Em Andamento', 'Concluído'];
                initialColumns.forEach(title => {
                    const column = createColumn(title);
                    const stack = column.querySelector('.post-it-stack');
                    for(let i = 0; i < 3; i++) {
                        createPostIt(stack, {
                           title: `${title} - Tarefa ${i + 1}`,
                           content: 'Este é um exemplo de conteúdo. Dê um duplo clique para editar.'
                        });
                    }
                    rearrangeStack(stack);
                });
                saveState(); // Salva o estado inicial padrão
            }

            loadState(); // Ponto de entrada principal
        });
    </script>
</body>
</html>